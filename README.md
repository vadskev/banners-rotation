## Особенности проекта
Сервис «Ротация баннеров» предназначен для выбора наиболее эффективных (кликабельных) баннеров, в условиях меняющихся предпочтений пользователей и набора баннеров.

Данный проект был реализован с целью обучения, познания принципов SOLID и чистой архитектуры.

Сервис состоит из API и базы данных в которой хранится информация о баннерах.<br>
Сервис предоставляет gRPC API.<br>


### Проект использует:
* Стандартные CRUD-операции таблицы базы данных
* gRPC endpoints в распространенном формате
* Управление конфигурацией приложения, в зависимости от среды
* Структурированное логирование
* Обработку ошибок с генерацией ответов
* Проверку валидности данных
* Контейнеризацию в Docker образе

### API поддерживает следующие операции:
* добавить Баннер
* удалить Баннер
* добавить Слот
* удалить Слот
* добавить Соц-дем. группу пользователей
* удалить Соц-дем. группу пользователей
* прикрепить Баннер к Слоту
* открепить Баннер из Слота
* засчитать переход по баннеру
* выбрать баннер для показа

## Начало работы

Если вы впервые сталкиваетесь с Go, [установите Go по инструкции](https://golang.org/doc/install) на свой компьютер. Для проекта требуется Go 1.22.4 или выше.

[Docker](https://www.docker.com/get-started) можно также установить, если вы не хотите настраивать окружение для работы. Проекту требуется Docker 17.05 или выше.

Также для работы в терминале, рекомендую установить [Taskfile](https://taskfile.dev/installation/).

После установки Go, Docker и TaskFile выполните следующие команды, чтобы начать работу:

```shell
## Запуск TODO-проекта
# скачиваем репозиторий
git clone https://github.com/vadskev/banners-rotation.git
cd banners-rotation

# создаем конфигурацию .env:
$ nano deployments/env/.env {
COMPOSE_PROJECT_NAME=banners-api

PG_HOST=localhost
PG_PORT=5432
POSTGRES_DB=banners_db
POSTGRES_USER=banners_user
POSTGRES_PASSWORD=banners_pass

MIGRATION_DIR=./migrations

LOG_LEVEL=info

GRPC_HOST=localhost
GRPC_PORT=50051
}

# скачиваем зависимости:
go mod tidy

# запускаем сборку приложения:
make build

# запускаем сервер:
go run ./cmd
```

Проект будет доступен по адресу: `http://localhost:50051`. Сервер предоставляет следующие endpoint:

* `/AddBanner`: добавляет баннер
* `/DeleteBanner`: удаляет баннер

* `/AddSlot`: добавляет слот
* `/DeleteSlot`: удаляет слот

* `/AddSocialGroup`: добавляет соц-дем. группу
* `/DeleteSocialGroup`: удаляет соц-дем. группу

* `/AttachBanner`: прикрепляет баннер к слоту
* `/DetachBanner`: открепляет баннер из слота

* `/HitBanner`: засчитывает показ
* `/SelectBanner`: возвращает баннер для показа

Каталоги первого уровня `cmd`, `internal`, `pkg` обычно встречаются в других популярных проектах Go, как описано
в разделе [Standard Go Project Layout](https://github.com/golang-standards/project-layout).

Пакет `internal` структурирован в соответствии с [screaming architecture](https://blog.cleancoder.com/uncle-bob/2011/09/30/Screaming-Architecture.html).
Например, пакет `storage` содержит логику, связанную с передачей данных в базу данных.

В каждом пакете функций код организован по уровням (API, service, repository) в соответствии с рекомендациями по зависимостям,
описанными в [clean architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html).

## Управление конфигурацией

Конфигурация приложения представлена в директории `internal/config/*`.

При запуске приложение загружает конфигурацию из переменных окружения. Путь к переменным окружения должен быть расположен следующим образом: `deployments/env/.env`.